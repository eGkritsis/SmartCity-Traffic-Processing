# Σύστημα Επεξεργασίας Ροών Βίντεο Κυκλοφορίας

## Περιγραφή
Το παρόν σύστημα στοχεύει στην ανάλυση ροών βίντεο από κάμερες κυκλοφορίας για την αυτόματη ανίχνευση, καταγραφή και αξιολόγηση της κυκλοφοριακής ροής, της ταχύτητας οχημάτων και της ύπαρξης παραβάσεων. Χρησιμοποιεί τεχνολογίες cloud (Azure Functions, Blob Storage, Cosmos DB) και τεχνικές computer vision (OpenCV, YOLOv3-tiny).

## Αρχιτεκτονική
Η αρχιτεκτονική αποτελείται από τα παρακάτω βήματα:
1.	**Αποθήκευση Αρχικού Βίντεο**: Τα βίντεο αποθηκεύονται στο raw-video container του Azure Blob Storage.
2.	**Διάσπαση Βίντεο**: Η Azure Function VideoSplitFunction διασπά κάθε βίντεο σε clips διάρκειας 2 λεπτών.
3.	**Επεξεργασία Βίντεο**: Η VideoProcessingFunction ανιχνεύει οχήματα, υπολογίζει ταχύτητες και κατευθύνσεις, και αποθηκεύει τα αποτελέσματα στο container processed-stats.
4.	**Αποθήκευση Δεδομένων**: Η CosmosDB Function μεταφέρει τα δεδομένα στην Azure Cosmos DB, προσθέτοντας μοναδικά IDs και προσαρμόζοντας timestamps.
5.	**Αναφορές και Οπτικοποίηση**: Τα δεδομένα αναλύονται και οπτικοποιούνται μέσω Power BI για την εξαγωγή στατιστικών (π.χ. μέσες ταχύτητες, υπερβάσεις ορίων κ.ά.).

## Περιγραφή Υλοποίησης

1. ### VideoSplitFunction
-	Ενεργοποιείται μέσω HTTP.
-	Χρησιμοποιεί FFmpeg για να διαχωρίσει το βίντεο.
-	Αποθηκεύει τα clips στο container splitted-videos.
-	Υποστηρίζει fallback μηχανισμό για εντοπισμό του FFmpeg και logging.

2. ### VideoProcessingFunction
- Επεξεργάζεται κάθε clip ξεχωριστά.
- Εντοπίζει αυτοκίνητα και φορτηγά με το YOLOv3-tiny.
-	Υπολογίζει μέγιστη ταχύτητα, κατεύθυνση, θέση και χρονική σήμανση.
-	Δημιουργεί JSON με στατιστικά και το ανεβάζει στο container processed-stats.

     **Processing.py**
-	Περιέχει τη λογική παρακολούθησης οχημάτων (VehicleTracker).
-	Υπολογίζει ταχύτητες με βάση την απόσταση ανά frame.
-	Προσφέρει smoothing με μέσο όρο για αξιόπιστες τιμές.
-	Εντοπίζει κατεύθυνση κίνησης και υπερβάσεις ταχύτητας (>130 km/h).

3. ### CosmosDB Function
-	Διαβάζει τα JSON αποτελέσματα και τα μεταφέρει στην Cosmos DB.
-	Δημιουργεί μοναδικά IDs (π.χ. 3_1) για κάθε όχημα.
-	Προσαρμόζει τα timestamps με βάση τη θέση του clip.
-	Χειρίζεται σφάλματα και επιστρέφει αναφορές επιτυχίας/αποτυχίας.

## Ερωτήματα (CosmosDB Queries)
Παρέχονται queries για:
-	Εντοπισμό ταχύτητας συγκεκριμένου οχήματος.
-	Υπολογισμό πλήθους οχημάτων ανά ρεύμα και ανά 5λεπτο.
-	Μέση ταχύτητα ανά ρεύμα.
-	Εντοπισμό οχημάτων που υπερβαίνουν τα επιτρεπτά όρια (90km/h για Ι.Χ., 80km/h για φορτηγά).

## Τεχνολογίες που Χρησιμοποιήθηκαν
-	Azure Functions
-	Azure Blob Storage
-	Azure Cosmos DB
-	YOLOv3-tiny
-	OpenCV
-	FFmpeg
-	Power BI
